<dl class="portlet portletQgCarousel"
     i18n:domain="plone"
     tal:define="collection_url view/collection_url;
                 toLocalizedTime nocall:context/@@plone/toLocalizedTime;
                 headerfull view/data/header;
                 header python:headerfull.replace(' ', '')">

  <dt class="portletHeader">
    <span class="portletTopLeft"></span>
    <a tal:attributes="href collection_url" tal:omit-tag="not:view/data/show_more">
      <span tal:content="view/data/header" />
    </a>
    <span class="portletTopRight"></span>
  </dt>

  <dd class="portletItem">
    <div tal:attributes="id header" class="qg-carousel">
      <div class="qg-wrapper-outer">
        <div class="qg-wrapper">
          <div class="qg-item" tal:repeat="item view/results">
            <a tal:define="obj item/getObject;"
               href="#"
               class="tile item-visual"
               tal:attributes="href item/getURL">
              <span tal:define="scales obj/@@images;
                               thumbnail python: scales.scale('image', width=400, height=400);
                               img thumbnail/url|nothing"
                    tal:condition="python:item.portal_type in ['Image', 'News Item']"
                    tal:omit-tag="not:thumbnail"
                    tal:attributes="style string:background-image:url($img)"
                    class="image-block">
              </span>
              <span class="itemBody">
                <span class="itemBlock itemTitle"
                      tal:content="item/Title|item/getId|item/id">
                  Title
                </span>
                <span class="itemBlock itemDate"
                      tal:condition="view/data/show_dates"
                      tal:content="python:toLocalizedTime(item.Date)">
                  Date
                </span>
                <span class="itemBlock itemDescription" tal:content="item/Description">
                  Description
                </span>
              </span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </dd>

  <dd class="portletFooter" tal:condition="view/data/show_more">
    <span class="portletBottomLeft"></span>
    <span>
      <a tal:attributes="href collection_url"
         tal:content="structure view/show_more_label">
        More&hellip;
      </a>
    </span>
    <span class="portletBottomRight"></span>
  </dd>

  <tal:x replace="structure string:&lt;script type='text/javascript'&gt;"></tal:x>
    $(document).ready(function() {
      $("#<tal:x replace="header"></tal:x>").qgCarousel();
    });
  <tal:x replace="structure string: &lt;/script&gt;" ></tal:x>

 </dl>
